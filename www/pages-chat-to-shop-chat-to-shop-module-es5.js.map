{"version":3,"sources":["webpack:///src/app/pages/chat-to-shop/chat-to-shop.page.html","webpack:///src/app/pages/chat-to-shop/chat-to-shop.page.ts","webpack:///src/app/pages/chat-to-shop/chat-to-shop.module.ts"],"names":["ChatToShopPage","modalController","camera","actionSheetController","loading","navCtrl","apiService","route","translate","alertService","blobToFile","theBlob","fileName","b","lastModifiedDate","Date","name","data_history","JSON","parse","localStorage","getItem","flag_user","data_chat","type","avatar","message","images","message_content","list_image_select","getAllOrderHistoryComment","content","scrollToBottom","self","present","getcommentOrderV2","_id","subscribe","result","listComment","orderHistoryCommentsV2","forEach","comment","createdBy","attachments","length","object","displayName","url","push","dismiss","setTimeout","error","param","orderHistoryId","postCommentOrderV2","presentToast","listAttachments","data_chat_image","i","media","concat","create","header","instant","buttons","text","handler","checkPicturePermission","PictureSourceType","PHOTOLIBRARY","CAMERA","role","actionSheet","sourceType","pickImage","options","quality","destinationType","DestinationType","DATA_URL","encodingType","EncodingType","JPEG","mediaType","MediaType","PICTURE","targetWidth","targetHeight","correctOrientation","getPicture","then","imageData","base64Define","binaryBlob","convertBase64ToBlob","date","valueOf","formData","FormData","myFile","payload","append","uploadImage","eventSendImage","err","base64","info","getInfoFromBase64","sliceSize","byteCharacters","window","atob","rawBase64","byteArrays","offset","slice","byteNumbers","Array","charCodeAt","Uint8Array","Blob","mime","meta","split","replace","exec","extension","selectImage","selector","templateUrl","styleUrls","routes","path","component","ChatToShopPageModule","forChild","imports","declarations"],"mappings":"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","file":"pages-chat-to-shop-chat-to-shop-module-es5.js","sourcesContent":["<ion-header class=\"order-chat-header\">\r\n  <ion-buttons class=\"back-button\">\r\n    <ion-back-button text=\"\" icon=\"chevron-back\" class=\"ion-back-button\"></ion-back-button>\r\n  </ion-buttons>\r\n  <ion-label class=\"header-title\">{{data_history.title}}</ion-label>\r\n  <!-- <ion-toolbar>\r\n    <ion-title>{{data_history.title}}</ion-title>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-back-button text=\"\" icon=\"chevron-back\"></ion-back-button>\r\n    </ion-buttons>\r\n  </ion-toolbar> -->\r\n</ion-header>\r\n<ion-content #content>\r\n  <ion-list lines=\"full\" class=\"ion-no-margin ion-no-padding padding-top-10 padding-bottom-20 ion-list-class\">\r\n    <div *ngFor=\"let message of data_chat\" class=\"ion-item-message {{getMarginTop(message)}}\">\r\n      <div *ngIf=\"message.type == 'left' && (message.message != '' || message.images != '')\" class=\"div-avatar\">\r\n        <ion-avatar> <img src=\"{{message.avatar}}\"></ion-avatar>\r\n        <ion-label >{{message.name}}</ion-label>\r\n      </div>\r\n      <div *ngIf=\"message.type == 'left' && message.message != ''\" class=\"col-7 div-label-message-left\">\r\n        <ion-label class=\"label-message-left\">{{message.message}}</ion-label>\r\n      </div>\r\n      <div *ngIf=\"message.type == 'left' && message.message == '' && message.images != ''\" class=\"col-7 div-image-message-left\">\r\n          <img class=\"\" src=\"{{message.images}}\"/>\r\n      </div>\r\n      <div *ngIf=\"message.type == 'right' && message.message != ''\" class=\"col-7 div-label-message-right\" slot=\"end\">\r\n        <ion-label class=\"label-message-right\">{{message.message}}</ion-label>\r\n      </div>\r\n      <div *ngIf=\"message.type == 'right' && message.message == '' && message.images != ''\" class=\"col-7 div-image-message-right\" slot=\"end\">\r\n        <img class=\"\" src=\"{{message.images}}\"/>\r\n      </div>\r\n    </div>\r\n  </ion-list>\r\n</ion-content>\r\n<section class=\"full-width function-section shadow-section center-div\">\r\n  <div class=\"col-2 center-div\">\r\n    <ion-button expand=\"block\" class=\"button-section\" (click)=\"selectImage()\">\r\n      <img class=\"icon-select-image\" src=\"../assets/icon/svg/icon-select-image.svg\"/>\r\n    </ion-button>\r\n  </div>\r\n  <div class=\"col-8 center-div div-text-area-1\">\r\n    <ion-textarea class=\"text-area-1\" auto-grow=\"true\" rows=\"1\"\r\n      placeholder=\"{{ 'SEVICE_10.placeholder_textarea' | translate }}\"\r\n      [(ngModel)]=\"message_content\"\r\n    ></ion-textarea>\r\n  </div>\r\n  <div class=\"col-2 center-div\">\r\n    <ion-button expand=\"block\" class=\"button-section\" *ngIf=\"message_content == ''\">\r\n      <img class=\"icon-send-inactive\" src=\"../assets/icon/svg/icon-send-inactive.svg\"/>\r\n    </ion-button>\r\n    <ion-button expand=\"block\" class=\"button-section\" *ngIf=\"message_content != ''\" (click)=\"eventButtonSendMessage()\">\r\n      <img class=\"icon-send-active\" src=\"../assets/icon/svg/icon-send-active.svg\"/>\r\n    </ion-button>\r\n  </div>\r\n</section>\r\n  ","import { Component, OnInit, ViewChild  } from '@angular/core';\r\nimport { Camera, CameraOptions, PictureSourceType } from '@ionic-native/Camera/ngx';\r\nimport { ApiService } from '../../services/api/api.service';\r\nimport { ActionSheetController, NavController, IonContent  } from '@ionic/angular';\r\nimport { LoadingService } from '../../services/loading/loading.service';\r\nimport { ModalController } from '@ionic/angular';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { AlertService } from '../../services/alert/alert.service';\r\nimport { TranslateService } from '@ngx-translate/core';\r\n\r\n@Component({\r\n  selector: 'app-chat-to-shop',\r\n  templateUrl: './chat-to-shop.page.html',\r\n  styleUrls: ['./chat-to-shop.page.scss'],\r\n})\r\nexport class ChatToShopPage implements OnInit {\r\n  @ViewChild('content') private content: any;\r\n  data_history: any;\r\n  data_chat: any;\r\n  message_content: any;\r\n  list_image_select: any;\r\n  flag_user: any;\r\n\r\n  constructor(\r\n    public modalController: ModalController,\r\n    private camera: Camera,\r\n    public actionSheetController: ActionSheetController,\r\n    private loading: LoadingService,\r\n    private navCtrl: NavController,\r\n    private apiService: ApiService,\r\n    private route: ActivatedRoute,\r\n    private translate: TranslateService,\r\n    private alertService: AlertService,\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.data_history = JSON.parse(localStorage.getItem('data-order-history'));\r\n    this.flag_user = \"\";\r\n    this.data_chat = [\r\n      {type: 'left', avatar: \"../assets/images/services/9.jpg\", message: \"Chào ban, chúng tôi có thể giúp gì được cho bạn\", images: \"\"},\r\n      {type: 'left', avatar: \"../assets/images/services/9.jpg\", message: \"\", images: \"../assets/images/services/9.jpg\"},\r\n      {type: 'right', avatar: \"../assets/images/services/9.jpg\", message: \"Tôi đặt hàng lâu rồi mà không thấy shop giao đến\"},\r\n      {type: 'right', avatar: \"../assets/images/services/9.jpg\", message: \"\", images: \"../assets/images/services/9.jpg\"},\r\n    ]\r\n    this.message_content = \"\";\r\n    this.list_image_select = [];\r\n    this.getAllOrderHistoryComment();\r\n  }\r\n  ionViewWillEnter(){\r\n    this.content.scrollToBottom(0);\r\n  }\r\n  getMarginTop(message) {\r\n    if (this.flag_user != message.type) {\r\n      this.flag_user = message.type;\r\n      return 'margin-top-20';\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n  getAllOrderHistoryComment() {\r\n    var self = this;\r\n    this.data_chat = [];\r\n    this.loading.present();\r\n    this.apiService.getcommentOrderV2(this.data_history._id)\r\n      .subscribe(result => {\r\n        const listComment = result.orderHistoryCommentsV2;\r\n        listComment.forEach(comment => {\r\n          let type = 'left';\r\n          if (comment.createdBy._id == self.data_history.createdBy._id) {\r\n            type = 'right';\r\n          }\r\n          if (comment.attachments.length > 0) {\r\n            comment.attachments.forEach(attachments => {\r\n              let object = {\r\n                type: type, \r\n                avatar: comment.createdBy.avatar,\r\n                name: comment.createdBy.displayName,\r\n                message: \"\", \r\n                images: attachments.url\r\n              }\r\n              self.data_chat.push(object);\r\n            })\r\n          } else {\r\n            let object = {\r\n              type: type, \r\n              avatar: comment.createdBy.avatar,\r\n              name: comment.createdBy.displayName,\r\n              message: comment.content, \r\n              images: \"\"\r\n            }\r\n            self.data_chat.push(object);\r\n          }\r\n        });\r\n        self.loading.dismiss();\r\n        setTimeout(() => {\r\n          self.content.scrollToBottom(100);\r\n        }, 200);\r\n        \r\n    },\r\n    error => {\r\n      self.loading.dismiss();\r\n    });\r\n  }\r\n  eventButtonSendMessage() {\r\n    var self = this;\r\n    var param = {\r\n      orderHistoryId: this.data_history._id,\r\n      attachments: [],\r\n      content: self.message_content\r\n    }\r\n    this.loading.present();\r\n    this.apiService.postCommentOrderV2(param)\r\n      .subscribe(result => {\r\n        self.data_chat.push(\r\n          {type: 'right', avatar: \"\", message: self.message_content}\r\n        )\r\n        self.message_content = \"\";\r\n        self.loading.dismiss();\r\n        setTimeout(() => {\r\n          self.content.scrollToBottom(100);\r\n        }, 200);\r\n    },\r\n    error => {\r\n      self.loading.dismiss();\r\n      self.alertService.presentToast('Send message fail');\r\n    });\r\n  }\r\n\r\n  eventSendImage() {\r\n    var self = this;\r\n    let listAttachments = [];\r\n    let data_chat_image = [];\r\n    for(var i=0;i<self.list_image_select.length;i++){\r\n      listAttachments.push(self.list_image_select[i].media);\r\n      data_chat_image.push({\r\n        type: 'right', avatar: \"\", message: \"\", images: self.list_image_select[i].media.url\r\n      });\r\n    }\r\n    var param = {\r\n      orderHistoryId: this.data_history._id,\r\n      attachments: listAttachments,\r\n      content: \" \"\r\n    }\r\n    if (listAttachments.length == 0) return;\r\n    this.loading.present();\r\n    this.apiService.postCommentOrderV2(param)\r\n      .subscribe(result => {\r\n        self.data_chat = self.data_chat.concat(data_chat_image);\r\n        self.list_image_select = [];\r\n        self.loading.dismiss();\r\n        setTimeout(() => {\r\n          self.content.scrollToBottom(100);\r\n        }, 300);\r\n    },\r\n    error => {\r\n      self.loading.dismiss();\r\n      self.alertService.presentToast('Send image fail');\r\n    });\r\n  }\r\n\r\n  // select image\r\n  async selectImage() {\r\n    const actionSheet = await this.actionSheetController.create({\r\n      header: this.translate.instant('COMMON.form_select_image_title'),\r\n      buttons: [{\r\n        text: this.translate.instant('COMMON.form_select_image_library'),\r\n        handler: () => {\r\n          this.checkPicturePermission(this.camera.PictureSourceType.PHOTOLIBRARY);\r\n        }\r\n      },\r\n      {\r\n        text: this.translate.instant('COMMON.form_select_image_camera'),\r\n        handler: () => {\r\n          this.checkPicturePermission(this.camera.PictureSourceType.CAMERA);\r\n        }\r\n      },\r\n      {\r\n        text: this.translate.instant('COMMON.form_select_image_cancel'),\r\n        role: 'cancel'\r\n      }\r\n      ]\r\n    });\r\n    await actionSheet.present();\r\n  }\r\n\r\n  checkPicturePermission(sourceType : PictureSourceType) {\r\n    this.pickImage(sourceType);\r\n  }\r\n\r\n  blobToFile = (theBlob: Blob, fileName:string): any => {\r\n    var b: any = theBlob;\r\n    //A Blob() is almost a File() - it's just missing the two properties below which we will add\r\n    b.lastModifiedDate = new Date();\r\n    b.name = fileName;\r\n\r\n    //Cast to a File() type\r\n    return theBlob;\r\n  }\r\n\r\n  pickImage(sourceType) {\r\n    var self = this;\r\n    const options: CameraOptions = {\r\n      quality: 80,\r\n      sourceType: sourceType,\r\n      destinationType: this.camera.DestinationType.DATA_URL,\r\n      encodingType: this.camera.EncodingType.JPEG,\r\n      mediaType: this.camera.MediaType.PICTURE,\r\n      targetWidth: 800,\r\n      targetHeight: 800,\r\n      correctOrientation: true,\r\n    }\r\n    \r\n    this.camera.getPicture(options).then((imageData) => {\r\n    \r\n      const base64Define = 'data:image/jpeg;base64,';\r\n      var binaryBlob = this.convertBase64ToBlob(base64Define+imageData);\r\n      const date = new Date().valueOf();\r\n      const formData = new FormData();\r\n      var fileName = \"amoapp\" + date + \".jpg\";\r\n      var myFile = self.blobToFile(binaryBlob, fileName);\r\n      const payload = new FormData();\r\n      payload.append('media', binaryBlob, fileName);\r\n\r\n      this.apiService.uploadImage(payload)\r\n      .subscribe(result => {\r\n        self.list_image_select = [];\r\n        self.list_image_select.push(result);\r\n        self.eventSendImage();\r\n      },\r\n        error => {\r\n      });\r\n    }, (err) => {});\r\n  }\r\n\r\n  private convertBase64ToBlob(base64: string) {\r\n    const info = this.getInfoFromBase64(base64);\r\n    const sliceSize = 512;\r\n    const byteCharacters = window.atob(info.rawBase64);\r\n    const byteArrays = [];\r\n\r\n    for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n      const slice = byteCharacters.slice(offset, offset + sliceSize);\r\n      const byteNumbers = new Array(slice.length);\r\n\r\n      for (let i = 0; i < slice.length; i++) {\r\n        byteNumbers[i] = slice.charCodeAt(i);\r\n      }\r\n\r\n      byteArrays.push(new Uint8Array(byteNumbers));\r\n    }\r\n\r\n    return new Blob(byteArrays, { type: info.mime });\r\n  }\r\n\r\n  private getInfoFromBase64(base64: string) {\r\n    const meta = base64.split(',')[0];\r\n    const rawBase64 = base64.split(',')[1].replace(/\\s/g, '');\r\n    const mime = /:([^;]+);/.exec(meta)[1];\r\n    const extension = /\\/([^;]+);/.exec(meta)[1];\r\n\r\n    return {\r\n      mime,\r\n      extension,\r\n      meta,\r\n      rawBase64\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { ChatToShopPage } from './chat-to-shop.page';\r\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\r\nimport { SuperTabsModule } from '@ionic-super-tabs/angular';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ChatToShopPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    TranslateModule,\r\n    SuperTabsModule,\r\n    RouterModule.forChild(routes)\r\n  ],\r\n  declarations: [ChatToShopPage]\r\n})\r\nexport class ChatToShopPageModule {}\r\n"]}