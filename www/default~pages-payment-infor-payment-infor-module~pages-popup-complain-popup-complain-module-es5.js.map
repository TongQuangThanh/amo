{"version":3,"sources":["webpack:///src/app/pages/popup-complain/popup-complain.page.html","webpack:///src/app/pages/popup-complain/popup-complain.page.ts"],"names":["PopupComplainPage","translateConfigService","modalController","platform","loading","apiService","navCtrl","navParams","authService","camera","actionSheetController","alertService","translate","route","blobToFile","theBlob","fileName","b","lastModifiedDate","Date","name","selectedLanguage","getDefaultLanguage","self","ready","then","readySource","widthListScreen","width","heightScreen","height","defineHeightScreen","requestDetailComponentShare","paymentBillID","data","id","flag_user","data_chat","editorMsg","list_image_select","profile","getProfile","_id","userID","getPaymentComment","present","getListPaymentComment","subscribe","result","dismiss","listPaymentComment","paymentComments","forEach","product","type","createdBy","attachments","length","object","avatar","message","images","url","push","content","scrollToBottom","error","params","bill","sendPaymentComment","setTimeout","listAttachments","data_chat_image","i","media","param","concat","presentToast","create","header","instant","buttons","text","handler","checkPicturePermission","PictureSourceType","PHOTOLIBRARY","CAMERA","role","actionSheet","sourceType","pickImage","options","quality","destinationType","DestinationType","DATA_URL","encodingType","EncodingType","JPEG","mediaType","MediaType","PICTURE","targetWidth","targetHeight","correctOrientation","getPicture","imageData","base64Define","binaryBlob","convertBase64ToBlob","date","valueOf","formData","FormData","myFile","payload","append","uploadImage","eventSendImage","err","base64","info","getInfoFromBase64","sliceSize","byteCharacters","window","atob","rawBase64","byteArrays","offset","slice","byteNumbers","Array","charCodeAt","Uint8Array","Blob","mime","meta","split","replace","exec","extension","closeModal","selectImage","sendMsg","selector","templateUrl","styleUrls"],"mappings":"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","file":"default~pages-payment-infor-payment-infor-module~pages-popup-complain-popup-complain-module-es5.js","sourcesContent":["<ion-content class=\"content-wrap\" no-bounce>\r\n  <div class=\"content-container\">\r\n    <ion-item lines=\"none\" class=\"header-item ion-no-padding\">\r\n      <ion-title class=\"popup-title\">{{ 'PAYMENT_COMMENT.title' | translate }}</ion-title>\r\n      <ion-buttons slot=\"end\" (click)=\"closeModal()\" class=\"btn-close-popup\">\r\n        <ion-icon name=\"close\"></ion-icon>\r\n      </ion-buttons>\r\n    </ion-item>\r\n    <ion-content #content class=\"list-chat-content\">\r\n      <ion-list lines=\"full\" class=\"ion-no-margin ion-no-padding padding-top-10 padding-bottom-20 ion-list-class\">\r\n        <ion-item *ngFor=\"let message of data_chat\" class=\"ion-item-message {{getMarginTop(message)}}\">\r\n          <div *ngIf=\"message.type == 'left' && (message.message != '' || message.images != '')\" class=\"div-avatar\">\r\n            <ion-avatar> <img src=\"{{message.avatar}}\"></ion-avatar>\r\n          </div>\r\n          <div *ngIf=\"message.type == 'left' && message.message != ''\" class=\"col-7\">\r\n            <ion-label class=\"label-message-left-bql\">{{ 'PAYMENT_COMMENT.bql' | translate }}</ion-label>\r\n            <div class=\"div-label-message-left\">\r\n              <ion-label class=\"label-message-left\">{{message.message}}</ion-label>\r\n            </div>\r\n          </div>\r\n          <div *ngIf=\"message.type == 'left' && message.message == '' && message.images != ''\" class=\"col-7 div-image-message-left\">\r\n            <ion-label class=\"label-message-left-bql\">{{ 'PAYMENT_COMMENT.bql' | translate }}</ion-label>\r\n            <img class=\"\" src=\"{{message.images}}\"/>\r\n          </div>\r\n          <div *ngIf=\"message.type == 'right' && message.message != ''\" class=\"col-7 div-label-message-right\" slot=\"end\">\r\n            <ion-label class=\"label-message-right\">{{message.message}}</ion-label>\r\n          </div>\r\n          <div *ngIf=\"message.type == 'right' && message.message == '' && message.images != ''\" class=\"col-7 div-image-message-right\" slot=\"end\">\r\n            <img class=\"\" src=\"{{message.images}}\"/>\r\n          </div>\r\n        </ion-item>\r\n      </ion-list>\r\n    </ion-content>\r\n  </div>\r\n</ion-content>\r\n<ion-footer class=\"ion-no-border footer-content\">\r\n  <ion-item lines=\"none\" class=\"add-comment-item\">\r\n    <div class=\"div-select-image\" (click)=\"selectImage()\">\r\n      <ion-icon name=\"image\" slot=\"start\" class=\"add-image-icon\"></ion-icon>\r\n    </div>\r\n    <ion-textarea class=\"input-area\" #chat_input\r\n      rows=\"1\" wrap=\"soft\" maxlength=\"500\"\r\n      [(ngModel)]=\"editorMsg\" \r\n      auto-grow\r\n      placeholder=\"{{ 'REQUEST_DETAIL.place_holder_input' | translate }}\">\r\n      <ion-icon name=\"paper-plane\" class=\"icon-send icon-send-default\" (click)=\"sendMsg()\"></ion-icon>\r\n    </ion-textarea>    \r\n  </ion-item>\r\n</ion-footer>\r\n","import { ModalController } from '@ionic/angular';\r\nimport { TranslateConfigService } from '../../translate-config.service';\r\nimport { Component, OnInit, OnDestroy, ViewChild, AfterViewInit, Input, ElementRef } from '@angular/core';\r\nimport { ApiService } from '../../services/api/api.service';\r\nimport { ActionSheetController, NavController, NavParams, Platform } from '@ionic/angular';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { LoadingService } from '../../services/loading/loading.service';\r\nimport { ConstService } from '../../utils/const.service';\r\nimport { UtilsService } from '../../utils/utils.service';\r\nimport { AlertService } from '../../services/alert/alert.service';\r\nimport { Camera, CameraOptions, PictureSourceType } from '@ionic-native/Camera/ngx';\r\nimport { AuthService } from 'src/app/services/auth/auth.service';\r\nimport { TranslateService } from '@ngx-translate/core';\r\n\r\n@Component({\r\n  selector: 'app-popup-complain',\r\n  templateUrl: './popup-complain.page.html',\r\n  styleUrls: ['./popup-complain.page.scss'],\r\n})\r\nexport class PopupComplainPage implements OnInit {\r\n  selectedLanguage:string;\r\n  @ViewChild('content') content: any;\r\n  @ViewChild(\"chat_input\") inputField: ElementRef;\r\n  \r\n  data_chat: any;\r\n  list_image_select: any;\r\n  flag_user: any;\r\n\r\n  defineHeightScreen:number;\r\n  widthListScreen:number;\r\n  listPaymentComment: any;\r\n  paymentBillID:string;\r\n  heightScreen:number;\r\n  editorMsg:any;\r\n  userID: any;\r\n\r\n  constructor(\r\n    private translateConfigService: TranslateConfigService,\r\n    private modalController: ModalController,\r\n    private platform: Platform,\r\n    private loading: LoadingService,\r\n    private apiService: ApiService,\r\n    private navCtrl: NavController,\r\n    private navParams: NavParams,\r\n    private authService: AuthService,\r\n    private camera: Camera,\r\n    public actionSheetController: ActionSheetController,\r\n    private alertService: AlertService,\r\n    private translate: TranslateService,\r\n    private route: ActivatedRoute) { \r\n      this.selectedLanguage = this.translateConfigService.getDefaultLanguage();\r\n      var self = this;\r\n      platform.ready().then((readySource) => {\r\n        self.widthListScreen = platform.width() * 0.8;\r\n        self.heightScreen = platform.height() * 0.55;\r\n        self.defineHeightScreen = this.heightScreen;\r\n      });\r\n      UtilsService.requestDetailComponentShare = this;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.paymentBillID = this.navParams.data.id;\r\n    this.flag_user = \"\";\r\n    this.data_chat = [];\r\n    this.editorMsg = \"\";\r\n    this.list_image_select = [];\r\n    const profile = this.authService.getProfile();\r\n    if (profile && profile._id) {\r\n      this.userID = profile._id;\r\n    } else {\r\n      this.userID = \"\";\r\n    }\r\n    this.getPaymentComment();\r\n    \r\n  }\r\n\r\n  getPaymentComment() {\r\n    this.loading.present();\r\n    const self = this;\r\n    this.apiService.getListPaymentComment(this.paymentBillID)\r\n      .subscribe(result => {\r\n        self.loading.dismiss();\r\n        self.listPaymentComment = result.paymentComments;\r\n        self.listPaymentComment.forEach(product => {\r\n          let type = 'left';\r\n          if (product.createdBy._id == self.userID) {\r\n            type = 'right';\r\n          }\r\n          if (product.attachments.length > 0) {\r\n            product.attachments.forEach(attachments => {\r\n              let object = {\r\n                type: type, \r\n                avatar: product.createdBy.avatar || '../assets/icon/avatar-default.png', \r\n                message: \"\", \r\n                images: attachments.url\r\n              }\r\n              self.data_chat.push(object);\r\n            })\r\n          } else {\r\n            let object = {\r\n              type: type, \r\n              avatar: product.createdBy.avatar || '../assets/icon/avatar-default.png', \r\n              message: product.content, \r\n              images: \"\"\r\n            }\r\n            self.data_chat.push(object);\r\n          }\r\n        });\r\n        self.scrollToBottom();\r\n    },\r\n    error => {\r\n      self.loading.dismiss();\r\n    });\r\n  }\r\n\r\n  sendMsg(){\r\n    this.loading.present();\r\n    const self = this;\r\n    const params = {\r\n      content: this.editorMsg,\r\n      attachments: [],\r\n      bill: this.paymentBillID\r\n    }\r\n    this.apiService.sendPaymentComment(params)\r\n      .subscribe(result => {\r\n        self.data_chat.push(\r\n          {type: 'right', avatar: \"\", message: self.editorMsg}\r\n        )\r\n        self.loading.dismiss();\r\n        self.editorMsg = \"\";\r\n        self.scrollToBottom();\r\n    },\r\n    error => {\r\n      self.editorMsg = \"\";\r\n      self.loading.dismiss();\r\n    });\r\n  }\r\n\r\n  scrollToBottom() {\r\n    var self = this;\r\n    setTimeout(() => {\r\n      if (self.content.scrollToBottom) {\r\n        self.content.scrollToBottom();\r\n      }\r\n    }, 400)\r\n  }\r\n\r\n  getMarginTop(message) {\r\n    if (this.flag_user != message.type) {\r\n      this.flag_user = message.type;\r\n      return 'margin-top-20';\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  eventSendImage() {\r\n    var self = this;\r\n    let listAttachments = [];\r\n    let data_chat_image = [];\r\n    for(var i=0;i<self.list_image_select.length;i++){\r\n      listAttachments.push(self.list_image_select[i].media);\r\n      data_chat_image.push({\r\n        type: 'right', avatar: \"\", message: \"\", images: self.list_image_select[i].media.url\r\n      });\r\n    }\r\n    var param = {\r\n      content: \" \",\r\n      bill: this.paymentBillID,\r\n      attachments: listAttachments\r\n    }\r\n    if (listAttachments.length == 0) return;\r\n    this.loading.present();\r\n    this.apiService.sendPaymentComment(param)\r\n      .subscribe(result => {\r\n        self.data_chat = self.data_chat.concat(data_chat_image);\r\n        self.list_image_select = [];\r\n        self.scrollToBottom();\r\n        self.loading.dismiss();\r\n    },\r\n    error => {\r\n      self.loading.dismiss();\r\n      self.alertService.presentToast('Send image fail');\r\n    });\r\n  }\r\n\r\n  // select image\r\n  async selectImage() {\r\n    const actionSheet = await this.actionSheetController.create({\r\n      header: this.translate.instant('COMMON.form_select_image_title'),\r\n      buttons: [{\r\n        text: this.translate.instant('COMMON.form_select_image_library'),\r\n        handler: () => {\r\n          this.checkPicturePermission(this.camera.PictureSourceType.PHOTOLIBRARY);\r\n        }\r\n      },\r\n      {\r\n        text: this.translate.instant('COMMON.form_select_image_camera'),\r\n        handler: () => {\r\n          this.checkPicturePermission(this.camera.PictureSourceType.CAMERA);\r\n        }\r\n      },\r\n      {\r\n        text: this.translate.instant('COMMON.form_select_image_cancel'),\r\n        role: 'cancel'\r\n      }\r\n      ]\r\n    });\r\n    await actionSheet.present();\r\n  }\r\n\r\n  checkPicturePermission(sourceType : PictureSourceType) {\r\n    this.pickImage(sourceType);\r\n  }\r\n\r\n  blobToFile = (theBlob: Blob, fileName:string): any => {\r\n    var b: any = theBlob;\r\n    //A Blob() is almost a File() - it's just missing the two properties below which we will add\r\n    b.lastModifiedDate = new Date();\r\n    b.name = fileName;\r\n\r\n    //Cast to a File() type\r\n    return theBlob;\r\n  }\r\n\r\n  pickImage(sourceType) {\r\n    var self = this;\r\n    const options: CameraOptions = {\r\n      quality: 80,\r\n      sourceType: sourceType,\r\n      destinationType: this.camera.DestinationType.DATA_URL,\r\n      encodingType: this.camera.EncodingType.JPEG,\r\n      mediaType: this.camera.MediaType.PICTURE,\r\n      targetWidth: 800,\r\n      targetHeight: 800,\r\n      correctOrientation: true,\r\n    }\r\n    \r\n    this.camera.getPicture(options).then((imageData) => {\r\n      const base64Define = 'data:image/jpeg;base64,';\r\n      var binaryBlob = this.convertBase64ToBlob(base64Define+imageData);\r\n      const date = new Date().valueOf();\r\n      const formData = new FormData();\r\n      var fileName = \"amoapp\" + date + \".jpg\";\r\n      var myFile = self.blobToFile(binaryBlob, fileName);\r\n      const payload = new FormData();\r\n      payload.append('media', binaryBlob, fileName);\r\n      \r\n      this.apiService.uploadImage(payload)\r\n      .subscribe(result => {\r\n        self.list_image_select = [];\r\n        self.list_image_select.push(result);\r\n        self.eventSendImage();\r\n      },\r\n        error => {\r\n      });\r\n    }, (err) => {\r\n      // Handle error\r\n      // alert(err);\r\n    });\r\n  }\r\n\r\n  private convertBase64ToBlob(base64: string) {\r\n    const info = this.getInfoFromBase64(base64);\r\n    const sliceSize = 512;\r\n    const byteCharacters = window.atob(info.rawBase64);\r\n    const byteArrays = [];\r\n\r\n    for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n      const slice = byteCharacters.slice(offset, offset + sliceSize);\r\n      const byteNumbers = new Array(slice.length);\r\n\r\n      for (let i = 0; i < slice.length; i++) {\r\n        byteNumbers[i] = slice.charCodeAt(i);\r\n      }\r\n\r\n      byteArrays.push(new Uint8Array(byteNumbers));\r\n    }\r\n\r\n    return new Blob(byteArrays, { type: info.mime });\r\n  }\r\n\r\n  private getInfoFromBase64(base64: string) {\r\n    const meta = base64.split(',')[0];\r\n    const rawBase64 = base64.split(',')[1].replace(/\\s/g, '');\r\n    const mime = /:([^;]+);/.exec(meta)[1];\r\n    const extension = /\\/([^;]+);/.exec(meta)[1];\r\n\r\n    return {\r\n      mime,\r\n      extension,\r\n      meta,\r\n      rawBase64\r\n    };\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  closeModal() {\r\n    this.modalController.dismiss();\r\n  }\r\n}\r\n"]}